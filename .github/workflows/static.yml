!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صيدلية المشاعر | عطار القلوب</title>
    
    <!-- Fonts: 'Reem Kufi' for magical headings, 'Cairo' for text -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&family=Reem+Kufi:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        magic: ['Reem Kufi', 'sans-serif'],
                    },
                    colors: {
                        void: '#0f0518',
                        shelf: '#2d1b4e',
                        gold: '#ffd700',
                        purple: {
                            glow: '#b026ff',
                            deep: '#4b0082',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'bubble': 'bubble 4s ease-in infinite',
                        'glow': 'glow 3s ease-in-out infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' },
                        },
                        bubble: {
                            '0%': { transform: 'translateY(100%) scale(0.5)', opacity: 0 },
                            '50%': { opacity: 1 },
                            '100%': { transform: 'translateY(-20%) scale(1.2)', opacity: 0 },
                        },
                        glow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(176, 38, 255, 0.2)' },
                            '50%': { boxShadow: '0 0 40px rgba(176, 38, 255, 0.6)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "lucide-react": "https://esm.sh/lucide-react@0.263.1"
            }
        }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #0f0518;
            color: #e0d4e6;
            background-image: radial-gradient(circle at 50% 50%, #1a0b2e 0%, #0f0518 100%);
            overflow-x: hidden;
        }

        /* Bubbles Container */
        .cauldron-liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            overflow: hidden;
            pointer-events: none;
        }
        
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
        }

        /* Glass Panel */
        .glass-scroll {
            background: rgba(45, 27, 78, 0.4);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(176, 38, 255, 0.2);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .potion-bottle {
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.3));
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            FlaskConical, Sparkles, Feather, Music, Coffee, 
            Settings, Key, X, Heart, Wind, Flame
        } from 'lucide-react';

        // --- Mock Data (Demo Mode) ---
        const MOCK_POTIONS = {
            "قلق": {
                name: "إكسير السكينة الزرقاء",
                color: "#60a5fa", // Blue
                ingredients: [
                    { icon: "Wind", text: "تنفس بعمق (4 ثوانٍ شهيق، 7 حبس، 8 زفير)" },
                    { icon: "Coffee", text: "كوب دافئ من البابونج أو اليانسون" },
                    { icon: "Music", text: "استمع لصوت المطر الهادئ" }
                ],
                wisdom: "القلق لا يمنع كارثة الغد، بل يسرق سلام اليوم."
            },
            "حزن": {
                name: "ترياق الأمل الذهبي",
                color: "#fbbf24", // Gold
                ingredients: [
                    { icon: "Heart", text: "ضع يدك على قلبك واستشعر نبضك" },
                    { icon: "Feather", text: "اكتب 3 أشياء بسيطة تشعر بالامتنان لها" },
                    { icon: "Flame", text: "امشِ قليلاً تحت ضوء الشمس" }
                ],
                wisdom: "كل شيء يمر، وهذا أيضاً سيمر. أنت أقوى مما تظن."
            }
        };

        function App() {
            // Inputs
            const [feeling, setFeeling] = useState('');
            
            // System
            const [potion, setPotion] = useState(null);
            const [isBrewing, setIsBrewing] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('gemini_api_key') || '');
            
            // Visuals
            const [bubbles, setBubbles] = useState([]);

            // Generate random bubbles for animation
            useEffect(() => {
                const interval = setInterval(() => {
                    const newBubble = {
                        id: Date.now(),
                        left: Math.random() * 100 + '%',
                        size: Math.random() * 10 + 5 + 'px',
                        duration: Math.random() * 2 + 2 + 's'
                    };
                    setBubbles(prev => [...prev.slice(-15), newBubble]);
                }, 500);
                return () => clearInterval(interval);
            }, []);

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('gemini_api_key', key);
            };

            const brewPotion = async () => {
                if (!feeling.trim()) return;
                setIsBrewing(true);
                setPotion(null);

                // Demo Mode
                if (!apiKey) {
                    setTimeout(() => {
                        // Simple logic for demo
                        const key = feeling.includes('حزن') ? 'حزن' : 'قلق';
                        setPotion(MOCK_POTIONS[key] || MOCK_POTIONS['قلق']);
                        setIsBrewing(false);
                    }, 3000); // Wait for the brewing animation
                    return;
                }

                // AI Prompt
                const prompt = `أنت "عطار المشاعر" الحكيم في عالم خيالي.
                المستخدم يشعر بـ: "${feeling}".
                
                المهمة: اصنع له "وصفة معنوية/نفسية" كأنها جرعة سحرية.
                
                المخرجات JSON فقط:
                {
                    "name": "اسم خيالي للجرعة (مثلاً: ترياق الطمأنينة)",
                    "color": "لون الجرعة (hex code)",
                    "ingredients": [
                        { "icon": "Wind", "text": "خطوة تنفس أو تأمل" },
                        { "icon": "Coffee", "text": "اقتراح مشروب أو أكلة مريحة" },
                        { "icon": "Music", "text": "اقتراح صوتي (مطر، رياح، موسيقى)" }
                    ],
                    "wisdom": "حكمة قصيرة وعميقة تواسيه"
                }
                ملاحظة: الأيقونات المتاحة للنصوص هي: Wind, Coffee, Music, Heart, Flame, Feather. اختر الأنسب.`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    const parsed = JSON.parse(data.candidates[0].content.parts[0].text);
                    setPotion(parsed);
                } catch (error) {
                    setPotion(MOCK_POTIONS['قلق']); // Fallback
                } finally {
                    setIsBrewing(false);
                }
            };

            const getIcon = (name) => {
                const icons = { Wind, Coffee, Music, Heart, Flame, Feather };
                return icons[name] || Sparkles;
            };

            return (
                <div className="min-h-screen relative font-sans flex flex-col items-center justify-center p-4 overflow-hidden selection:bg-purple-glow selection:text-white">
                    
                    {/* Background Elements */}
                    <div className="fixed inset-0 pointer-events-none">
                        <div className="absolute top-10 left-10 w-32 h-32 bg-purple-glow/20 rounded-full blur-[80px]"></div>
                        <div className="absolute bottom-10 right-10 w-40 h-40 bg-blue-500/20 rounded-full blur-[80px]"></div>
                    </div>

                    {/* Navbar */}
                    <div className="absolute top-0 left-0 right-0 p-6 flex justify-between items-center z-50">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full border-2 border-gold/50 flex items-center justify-center animate-pulse">
                                <FlaskConical className="text-gold w-6 h-6" />
                            </div>
                            <h1 className="text-2xl font-magic text-gold tracking-widest drop-shadow-[0_0_10px_rgba(255,215,0,0.5)]">صيدلية المشاعر</h1>
                        </div>
                        <button onClick={() => setShowSettings(!showSettings)} className="text-purple-300 hover:text-gold transition-colors">
                            <Settings className="w-6 h-6" />
                        </button>
                    </div>

                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fadeIn">
                            <div className="glass-scroll p-6 rounded-2xl w-full max-w-md relative border border-purple-glow/50">
                                <button onClick={() => setShowSettings(false)} className="absolute top-4 left-4 text-gray-400 hover:text-white"><X /></button>
                                <h3 className="font-magic text-xl text-gold mb-4 flex items-center gap-2">
                                    <Key className="w-5 h-5" /> مفتاح العطار (API)
                                </h3>
                                <input 
                                    type="password" 
                                    value={apiKey}
                                    onChange={(e) => saveApiKey(e.target.value)}
                                    className="w-full bg-void/50 border border-purple-900 rounded-lg p-3 text-purple-100 focus:outline-none focus:border-gold mb-2"
                                    placeholder="ضع المفتاح هنا..."
                                />
                                <button onClick={() => setShowSettings(false)} className="mt-4 w-full bg-purple-deep hover:bg-purple-glow text-white py-2 rounded-lg font-bold transition-all shadow-[0_0_15px_rgba(176,38,255,0.4)]">حفظ التعويذة</button>
                            </div>
                        </div>
                    )}

                    <main className="w-full max-w-lg relative z-10 flex flex-col items-center">
                        
                        {/* Input Area (The Cauldron) */}
                        <div className={`
                            w-full glass-scroll rounded-[3rem] p-8 mb-8 relative overflow-hidden transition-all duration-700
                            ${isBrewing ? 'animate-shake border-gold/50' : 'hover:border-purple-glow/50'}
                        `}>
                            {/* Cauldron Glow */}
                            <div className="absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-purple-deep/40 to-transparent pointer-events-none"></div>
                            
                            {/* Bubbles Animation */}
                            <div className="cauldron-liquid">
                                {bubbles.map(b => (
                                    <div key={b.id} className="bubble animate-bubble"
                                         style={{ left: b.left, width: b.size, height: b.size, animationDuration: b.duration }}>
                                    </div>
                                ))}
                            </div>

                            <div className="relative z-10 text-center">
                                <label className="block text-purple-200 font-magic text-lg mb-4">بماذا يشعر قلبك اليوم؟</label>
                                <input 
                                    type="text" 
                                    value={feeling}
                                    onChange={(e) => setFeeling(e.target.value)}
                                    placeholder="أشعر بالقلق.. حزين قليلاً.."
                                    className="w-full bg-void/30 border-b-2 border-purple-glow/30 focus:border-gold text-center text-xl p-4 text-white outline-none placeholder-purple-400/30 transition-colors font-magic"
                                    onKeyDown={(e) => e.key === 'Enter' && brewPotion()}
                                />
                                
                                <button 
                                    onClick={brewPotion}
                                    disabled={isBrewing || !feeling}
                                    className={`mt-8 px-8 py-3 rounded-full font-magic text-lg font-bold flex items-center justify-center gap-2 mx-auto transition-all
                                        ${isBrewing 
                                            ? 'bg-purple-900/50 text-purple-300 cursor-wait' 
                                            : 'bg-gradient-to-r from-purple-deep to-purple-glow text-white shadow-[0_0_20px_rgba(176,38,255,0.4)] hover:scale-105 hover:shadow-[0_0_30px_rgba(176,38,255,0.6)]'}
                                    `}
                                >
                                    {isBrewing ? (
                                        <>
                                            <Sparkles className="animate-spin" /> جاري الخلط...
                                        </>
                                    ) : (
                                        <>
                                            <FlaskConical className="w-5 h-5" /> اصنع الترياق
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>

                        {/* Result Area (The Potion) */}
                        {potion && !isBrewing && (
                            <div className="w-full glass-scroll rounded-3xl p-8 relative animate-float border-t-2 border-gold/30">
                                {/* Top Decoration */}
                                <div className="absolute -top-6 left-1/2 transform -translate-x-1/2">
                                    <div className="w-12 h-12 bg-void border-2 border-gold rounded-full flex items-center justify-center shadow-[0_0_20px_rgba(255,215,0,0.5)]">
                                        <Sparkles className="text-gold w-6 h-6 animate-pulse" />
                                    </div>
                                </div>

                                <div className="mt-4 text-center">
                                    <h2 className="text-2xl font-magic font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-gold mb-2">
                                        {potion.name}
                                    </h2>
                                    
                                    {/* Potion Visual */}
                                    <div className="my-6 relative w-24 h-32 mx-auto">
                                        <div className="absolute inset-0 bg-white/10 rounded-full blur-xl animate-pulse"></div>
                                        {/* Simple CSS Bottle Shape */}
                                        <div className="w-full h-full rounded-b-[3rem] rounded-t-[1rem] relative overflow-hidden border-2 border-white/20 potion-bottle bg-black/20">
                                            <div 
                                                className="absolute bottom-0 left-0 right-0 transition-all duration-1000 ease-out"
                                                style={{ height: '70%', backgroundColor: potion.color, boxShadow: `0 0 30px ${potion.color}` }}
                                            >
                                                {/* Liquid bubbles */}
                                                <div className="absolute w-2 h-2 bg-white/50 rounded-full left-1/4 bottom-2 animate-bubble" style={{animationDuration: '2s'}}></div>
                                                <div className="absolute w-3 h-3 bg-white/50 rounded-full left-3/4 bottom-5 animate-bubble" style={{animationDuration: '3s'}}></div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Ingredients List */}
                                    <div className="space-y-3 text-right mb-8 bg-void/30 p-4 rounded-xl">
                                        <h3 className="text-xs font-bold text-purple-300 uppercase tracking-widest mb-2 border-b border-purple-800 pb-1">المكونات السحرية</h3>
                                        {potion.ingredients.map((ing, i) => {
                                            const Icon = getIcon(ing.icon);
                                            return (
                                                <div key={i} className="flex items-center gap-3 text-purple-100">
                                                    <div className="p-2 rounded-lg bg-purple-deep/30 text-gold">
                                                        <Icon className="w-4 h-4" />
                                                    </div>
                                                    <span className="text-sm">{ing.text}</span>
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {/* Wisdom */}
                                    <div className="relative p-6 bg-gradient-to-br from-purple-900/30 to-gold/5 rounded-xl border border-gold/10">
                                        <div className="absolute -top-3 -right-2 text-4xl text-gold/20 font-serif">"</div>
                                        <p className="font-magic text-lg text-gold italic leading-relaxed">
                                            {potion.wisdom}
                                        </p>
                                        <div className="absolute -bottom-6 -left-2 text-4xl text-gold/20 font-serif transform rotate-180">"</div>
                                    </div>

                                </div>
                            </div>
                        )}

                        {!potion && !isBrewing && (
                            <div className="text-center opacity-30 mt-8">
                                <p className="font-magic text-sm">العطار بانتظار مشاعرك ليخلط لك الدواء...</p>
                            </div>
                        )}

                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
